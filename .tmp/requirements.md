# 要件定義書 - AIチャット型情報管理システム（製造現場向け）

## 1. 目的

製造現場において、トラブルメンテナンス情報などの重要な業務データを、AIとの対話を通じて効率的に収集・保存・共有するシステムを構築する。AIによる自動補完機能により、現場での迅速なデータ入力を実現し、チーム全体での情報共有を促進する。

## 2. 機能要件

### 2.1 Phase 1 必須機能（MVP）

#### 2.1.1 ユーザー認証・管理
- [ ] ユーザー登録機能（メールアドレス、パスワード）
- [ ] ログイン/ログアウト機能
- [ ] パスワードリセット機能
- [ ] セッション管理（自動ログアウト）
- [ ] ロール管理
  - 管理者（Admin）: テーマの削除、ユーザー管理、システム設定
  - 一般ユーザー（Member）: テーマ作成・編集、データ閲覧・編集・削除
  - 初回登録ユーザーはMemberロール、管理者が昇格可能
  - 初回Adminはデプロイ時にシードデータとして作成

#### 2.1.2 テーマ管理
- [ ] テーマの作成機能（全ユーザー）
  - テーマ名の設定
  - 保存項目の定義（項目名、データ型、必須/任意）
- [ ] テーマの編集機能
  - 保存項目の追加・削除・並び替え
  - テーマ名の変更
- [ ] テーマの削除機能（管理者のみ）
  - 既存データがある場合の警告表示
  - 削除確認ダイアログ
- [ ] デフォルトテーマ
  - トラブルメンテナンス（日時、トラブル内容、原因、暫定対策、恒久対策）
  - システムが初期データとして自動作成
- [ ] サンプルデータ
  - チュートリアル用のサンプルチャット履歴
  - サンプル保存データ（2-3件）
  - ユーザーが機能を理解するための参考データ
- [ ] テーマ一覧表示
  - 作成者、作成日時、使用回数の表示
  - 検索・フィルタリング

#### 2.1.3 プロフィール設定
- [ ] 表示設定（言語、テーマ）

#### 2.1.4 AIチャット機能
- [ ] チャット開始時のテーマ選択
  - テーマ一覧から選択
  - お気に入りテーマの優先表示
- [ ] リアルタイムチャット画面
  - メッセージ送受信（テキスト）
  - チャット履歴表示（スクロール可能）
  - タイムスタンプ表示
  - 選択中のテーマ表示
- [ ] AI応答機能（Claude Sonnet 4.5）
  - ユーザー入力に対する自然な応答
  - テーマの保存項目に基づく不足情報の自動検出
  - 必要情報を埋めるための質問生成
  - 保存データの完全性チェック
  - 保存前の確認プロンプト
- [ ] 画像添付機能
  - チャット中に画像を添付可能
  - 最大5枚まで添付
  - 1枚あたり最大10MB
  - 対応形式: JPEG、PNG、WebP、GIF、BMP
  - サムネイル表示
  - 画像のプレビュー・拡大表示

#### 2.1.5 チャット履歴管理
- [ ] 履歴一覧表示
  - 履歴の見出しをAIが自動生成（例：「2026/1/28 ライン3トラブル対応」）
    - 生成タイミング: 最初の5メッセージで更新、以降は確定
  - 見出しの手動編集機能
  - 日付・時刻での並び替え
  - テーマでのフィルタリング
  - キーワード検索機能
- [ ] 履歴の継続機能
  - 過去のチャットセッションを選択して再開
  - 前回の文脈とテーマを保持
- [ ] 履歴の削除機能
  - 削除確認ダイアログ
  - 保存済みデータとの関連性表示

#### 2.1.6 データ保存機能
- [ ] 構造化データの保存
  - テーマの保存項目に基づく保存
  - Markdown形式での保存
  - 添付画像の保存（最大5枚）
  - メタデータの自動付与（作成者、作成日時、更新日時、テーマ）
- [ ] 保存前確認
  - AIが必要項目の充足を判断
  - ユーザーへの確認プロンプト表示
  - 修正・編集機能
- [ ] 自動保存（下書き）
  - チャット中の情報を一時保存
  - セッション切断時のデータ保護

#### 2.1.7 データ閲覧機能
- [ ] 一覧表示
  - 全ユーザーが全データを閲覧可能
  - カード形式またはリスト形式
  - テーマでのフィルタリング
  - 並び替え（日付、タイトル、作成者、テーマ）
  - ページネーションまたは無限スクロール
- [ ] 詳細表示
  - 保存された全項目の表示
  - Markdownのレンダリング
  - 添付画像の表示（ギャラリー形式、永続保存）
  - 編集・削除ボタン（全ユーザーが編集可能、削除は作成者または管理者のみ）
  - 削除時の警告ダイアログ
    - 「この操作は取り消せません」
    - 「他のユーザーも閲覧できなくなります」
  - 編集履歴の表示（誰が・いつ・何を変更したか）
- [ ] 検索機能
  - キーワード検索（保存されたデータのみ）
  - 項目別フィルタリング
  - テーマでの絞り込み
  - 日付範囲指定

#### 2.1.8 編集履歴管理
- [ ] 編集履歴の記録
  - データ作成・更新・削除の履歴を保存
  - 編集者、編集日時、変更内容を記録
  - 削除されたデータも履歴として保持
- [ ] 履歴の表示
  - データ詳細画面で編集履歴を表示
  - タイムライン形式で表示
  - 変更内容の差分表示
- [ ] 削除データの閲覧
  - 削除されたデータを履歴から確認可能
  - 復元機能は含まない（閲覧のみ）

#### 2.1.9 お気に入り機能
- [ ] テーマのお気に入り登録/解除（個人用）
- [ ] お気に入りテーマ一覧表示
- [ ] チャット開始時にお気に入りテーマを優先表示

#### 2.1.10 オフラインフォールバック
- [ ] オフライン検出
  - ネットワーク状態のリアルタイム監視
  - オフライン時のUIインジケーター表示
- [ ] ローカルキャッシュ（ユーザーが閲覧したデータのみ）
  - チャット履歴のローカルキャッシュ（IndexedDB、直近閲覧分）
  - 保存済みデータの読み取り専用キャッシュ（閲覧済みのもののみ）
  - テーマ定義のローカルキャッシュ（全件、軽量データ）
  - 画像はキャッシュ対象外（テキストデータのみ）
- [ ] オフライン時の動作
  - キャッシュ済みデータの閲覧は継続可能
  - テキスト入力の一時保存（オンライン復帰後に送信）
  - AIチャット・データ保存はオンライン復帰後に再開
  - オフライン中の操作は送信キューに保持
- [ ] オンライン復帰時の同期
  - キューに保持された操作の自動送信
  - コンフリクト発生時のユーザー通知

#### 2.1.11 管理者機能
- [ ] ユーザー管理
  - ユーザー一覧表示
  - ロールの変更（Admin ⇄ Member）
- [ ] テーマ管理（管理者権限）
  - 全テーマの削除権限
  - テーマの統合・整理機能
- [ ] システム設定
  - デフォルトテーマの変更

### 2.2 Phase 2 機能（MVP後に追加）

#### 2.2.1 チーム管理
> チームの用途は**通知のグルーピングのみ**。データのアクセス制御には関与しない。

- [ ] チーム作成機能（全ユーザー）
  - チーム名の設定
  - メンバーの招待
- [ ] チーム編集機能
  - メンバーの追加・削除
  - チーム名の変更
- [ ] チーム退出/削除機能
  - 退出確認ダイアログ
  - 最後のメンバーが退出時はチーム削除
- [ ] チーム一覧表示
  - 所属チーム一覧
  - メンバー数の表示
- [ ] 複数チーム所属対応
  - ユーザーは複数チームに参加可能

#### 2.2.2 音声入力・出力機能
- [ ] 音声入力
  - リアルタイム音声認識（日本語）
  - 無音検出による自動終了（設定可能な時間）
  - 音声入力中のビジュアルフィードバック
- [ ] 音声出力
  - AIの応答を音声で再生
  - 音声再生完了後の自動ユーザー入力待機
  - 音声再生のキャンセル機能
- [ ] 音声品質設定
  - マイク入力レベル調整
  - ノイズキャンセリング設定
- [ ] プロフィール音声設定
  - 無音検出時間の設定（デフォルト: 3秒、範囲: 1-10秒）

#### 2.2.3 通知機能
- [ ] 新規データ保存時の通知
  - チームメンバーへの通知
  - テーマごとの通知設定（ON/OFF）
  - ユーザーごとの通知設定（ON/OFF）
  - 通知ロジック：テーマOFF時はユーザーONでも通知しない
  - バッチ処理（5分毎）で配信
- [ ] 通知配信
  - アプリ内通知
  - メール通知（バッチ処理でまとめて送信）
  - ブラウザプッシュ通知（オプション）
- [ ] 通知一覧
  - 未読/既読管理
  - 通知からデータ詳細へのリンク
- [ ] プロフィール通知設定
  - テーマごとの通知ON/OFF
  - チームごとの通知ON/OFF
  - メール通知のON/OFF

### 2.3 オプション機能（将来追加予定）

- [ ] データのエクスポート（CSV、PDF）
- [ ] 統計・分析ダッシュボード（テーマ別、チーム別）
- [ ] 画像のAI認識機能（Vision API連携）
- [ ] コメント機能（保存データへのコメント）
- [ ] 履歴からのデータ復元機能
- [ ] テーマのテンプレート共有機能

## 3. 非機能要件

### 3.1 パフォーマンス

- **応答時間**
  - チャット応答: 3秒以内（通常時）
  - ページ読み込み: 2秒以内（初回）
  - オフラインキャッシュ読み込み: 500ms以内
- **同時接続数**
  - 100ユーザー規模の組織を想定
  - 同時利用50ユーザー程度をサポート

### 3.2 セキュリティ

- **認証・認可**
  - AWS Amplify Authによる認証
  - JWTトークンによるセッション管理
  - 多要素認証（MFA）のサポート
- **データ保護**
  - 通信の暗号化（HTTPS）
  - データベースの暗号化（保存時）
  - 個人情報の適切な管理
  - データ保存期間：無期限（削除はユーザー操作のみ）
- **アクセス制御**
  - 認証されたユーザーのみがアクセス可能
  - ロールベースアクセス制御（RBAC）
    - Admin: 全機能へのアクセス、ユーザー管理、テーマ削除
    - Member: データCRUD（削除は自身の作成分のみ）、テーマ作成・編集
  - API Gatewayでの認証・認可

### 3.3 保守性

- **コード品質**
  - TypeScriptによる型安全性
  - ESLint/Prettierによるコード規約準拠
  - 単体テスト、統合テストの実装
- **ドキュメント**
  - APIドキュメント（自動生成）
  - コンポーネントドキュメント
  - デプロイ手順書
- **監視・ログ**
  - CloudWatch Logsによるログ収集
  - エラートラッキング（Sentry等）
  - パフォーマンスモニタリング

### 3.4 互換性

- **ブラウザ対応**
  - Chrome（最新版、1つ前のバージョン）
  - Edge（最新版、1つ前のバージョン）
  - Safari（最新版、iOS含む）
  - Firefox（最新版）
- **デバイス対応**
  - **レスポンシブデザイン対応必須**
  - デスクトップ（Windows、macOS）
  - タブレット（iPad、Android）- 製造現場での主要デバイス
  - スマートフォン（iPhone、Android）
  - ブレークポイント: 320px / 768px / 1024px
- **アクセシビリティ**
  - WCAG 2.2 Level AA準拠
  - キーボード操作対応
  - スクリーンリーダー対応

## 4. 制約・前提

### 4.1 技術的制約

- **フロントエンド**
  - React + TypeScript + Vite 7
  - Serendie Design System 使用必須
    - `@serendie/serendie`（適応型UIコンポーネントライブラリ）
    - `@serendie/design-token`（W3C Design Tokens仕様準拠のデザイントークン）
    - `@serendie/serendie-symbols`（300以上のSVGアイコンセット）
  - デザイントークンによるスタイル管理（ハードコードされた値の禁止）
  - 適応型UI（Adaptive UI）による自動レスポンシブ対応
  - レスポンシブデザイン（ブレークポイント: 320px / 768px / 1024px）
  - Service Worker + IndexedDBによるオフラインキャッシュ
- **バックエンド**
  - AWS Amplify Gen 2（TypeScriptファーストのバックエンド定義）
  - AWS AppSync（GraphQL API）
  - Amazon DynamoDB（データストア）
  - Amazon Cognito（既存User Pool: us-west-2_eaUOifAaZ を継続使用）
  - AWS Lambda（ビジネスロジック）
  - Amazon Bedrock（AI機能）
- **ストレージ**
  - Amazon S3
    - 画像ファイル: 永続保存
- **インフラ**
  - Infrastructure as Code（AWS CDK、Amplify Gen 2内蔵）
  - リージョン: us-west-2
- **AI**
  - Amazon Bedrock（Claude Sonnet 4.5使用）
  - プロンプトエンジニアリング必須
- **Phase 2 追加技術**
  - Amazon Transcribe（音声認識）
  - Amazon Polly（音声合成）
  - Amazon S3 音声ファイル: 6時間後自動削除（ライフサイクルポリシー）

### 4.2 ビジネス制約

- **予算**
  - AWSの従量課金モデル
  - 初期段階はスケーリング考慮したコスト最適化
  - Claude Sonnet 4.5の利用コスト考慮
- **納期**
  - Phase 1（MVP）を優先リリース
  - Phase 2（音声・チーム・通知）は MVP 安定後に追加
- **組織**
  - 100ユーザー規模の組織を想定
  - Phase 1: テキスト入力中心
  - Phase 2: 音声入力追加（製造現場での利用拡大）
  - 既存システムとの連携は不要

## 5. 成功基準

### 5.1 Phase 1 完了の定義

- [ ] 全ての Phase 1 必須機能が実装され、動作確認済み
- [ ] セキュリティ要件を満たしている（RBAC含む）
- [ ] パフォーマンス目標を達成している
- [ ] オフラインフォールバックが動作確認済み
- [ ] アクセシビリティチェックで違反がない
- [ ] 単体テストカバレッジ80%以上
- [ ] 統合テストが全て通過
- [ ] ユーザー受け入れテスト（UAT）完了
- [ ] ドキュメントが完備されている
- [ ] 本番環境へのデプロイが成功している

### 5.2 受け入れ基準

- **ユーザー満足度**
  - 製造現場での実証テストで80%以上の満足度
  - 情報入力時間が従来比50%削減
- **システム品質**
  - 稼働率99%以上
  - 重大なセキュリティ脆弱性がない
  - バグ発生率が許容範囲内
  - 100ユーザー規模での安定動作
  - オフライン時にキャッシュデータが閲覧可能
- **ビジネス目標**
  - トラブル対応時間の短縮
  - テーマ別ナレッジベースの構築
  - AI活用による情報の完全性向上

## 6. 想定されるリスク

### 6.1 技術的リスク

- **AIの応答品質**
  - リスク: 不適切な質問や応答が生成される
  - 対策: プロンプトエンジニアリング、出力フィルタリング
- **レイテンシ**
  - リスク: AIの応答に時間がかかる
  - 対策: キャッシング、非同期処理、ストリーミング表示
- **AWS料金**
  - リスク: Bedrockのコストが予想を超える
  - 対策: 使用量モニタリング、アラート設定、コスト最適化
- **オフラインキャッシュの整合性**
  - リスク: オンライン復帰時にデータコンフリクトが発生
  - 対策: サーバー側タイムスタンプによる競合解決、ユーザー通知
- **Amplify Gen 2 の成熟度**
  - リスク: Gen 2 は比較的新しいため、ドキュメントやコミュニティリソースが限定的
  - 対策: 公式ドキュメントの継続的確認、必要に応じてカスタムCDK構成を使用

### 6.2 ビジネス的リスク

- **ユーザー採用**
  - リスク: 現場作業者がシステムを使いこなせない
  - 対策: 直感的なUI設計、トレーニング、マニュアル作成
- **データ品質**
  - リスク: AIの補完機能が不完全でデータ品質が低い
  - 対策: バリデーション強化、テーマ定義の明確化
- **テーマの乱立**
  - リスク: 全ユーザーが作成可能なため類似テーマが乱立
  - 対策: 管理者によるテーマ整理権限、テーマ検索機能、テンプレート推奨
- **全員編集可能による問題**
  - リスク: 重要データが誤って編集・削除される
  - 対策: 削除は作成者または管理者のみ、編集履歴管理
- **セキュリティ事故**
  - リスク: データ漏洩や不正アクセス
  - 対策: セキュリティ監査、定期的な脆弱性診断

---

**作成日**: 2026-01-28
**バージョン**: 2.1
**ステータス**: レビュー中
**変更履歴**:
- 1.0: 初版作成
- 2.0: Phase分割（音声・チーム・通知をPhase 2へ）、管理者ロール追加、オフラインフォールバック必須化、Amplify Gen 2へ変更
- 2.1: 初回Adminシードデータ作成、既存Cognito User Pool継続使用、オフラインキャッシュ範囲を閲覧済みデータに限定
