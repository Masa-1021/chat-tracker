# è©³ç´°è¨­è¨ˆæ›¸ - AIãƒãƒ£ãƒƒãƒˆå‹æƒ…å ±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆè£½é€ ç¾å ´å‘ã‘ï¼‰

## 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ï¼ˆPhase 1ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    React SPA (Vite 7 + TypeScript)                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚   èªè¨¼    â”‚ â”‚  ãƒãƒ£ãƒƒãƒˆ  â”‚ â”‚ ãƒ‡ãƒ¼ã‚¿ç®¡ç† â”‚ â”‚   ç®¡ç†    â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« â”‚ â”‚ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« â”‚ â”‚ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« â”‚ â”‚ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Serendie Design System  â”‚ â”‚  ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (IndexedDB)   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (@serendie/ui)          â”‚ â”‚  + Service Worker                 â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ HTTPS
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AWS Amplify Gen 2                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Amplify Hosting (CDN + SSL)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚                 â”‚
                    â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Amazon Cognito      â”‚ â”‚   AWS AppSync     â”‚ â”‚      Amazon S3            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚   (GraphQL API)   â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  User Pool    â”‚   â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”‚  ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«        â”‚  â”‚
â”‚   â”‚  us-west-2    â”‚   â”‚ â”‚   â”‚ Resolver  â”‚   â”‚ â”‚  â”‚  (æ°¸ç¶šä¿å­˜)         â”‚  â”‚
â”‚   â”‚  _eaUOifAaZ   â”‚   â”‚ â”‚   â”‚  - Query  â”‚   â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â”‚  (æ—¢å­˜)       â”‚   â”‚ â”‚   â”‚  - Mutationâ”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚   â”‚  - Sub    â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
                    â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Amazon DynamoDB     â”‚ â”‚   AWS Lambda      â”‚ â”‚    Amazon Bedrock         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  User         â”‚   â”‚ â”‚   â”‚ chatHandlerâ”‚   â”‚ â”‚    â”‚ Claude Sonnet   â”‚    â”‚
â”‚   â”‚  Theme        â”‚   â”‚ â”‚   â”‚ seedData   â”‚   â”‚ â”‚    â”‚ 4.5             â”‚    â”‚
â”‚   â”‚  ChatSession  â”‚   â”‚ â”‚   â”‚ searchData â”‚   â”‚ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚   â”‚  ChatMessage  â”‚   â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”‚  SavedData    â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”‚  EditHistory  â”‚   â”‚
â”‚   â”‚  FavoriteThemeâ”‚   â”‚
â”‚   â”‚  StreamChunk  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
|----------|------|
| è¨€èª | TypeScript 5.x |
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | React 19.x |
| ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« | Vite 7.x |
| UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª | @serendie/ui, @serendie/design-token, @serendie/serendie-symbols |
| çŠ¶æ…‹ç®¡ç† | TanStack Query (ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹) + Zustand (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹) |
| ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | React Router 7.x |
| ãƒ•ã‚©ãƒ¼ãƒ  | React Hook Form + Zod |
| GraphQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | AWS Amplify API (AppSync) |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ | Service Worker + IndexedDB (idb) |

> **UIã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**: Serendie Design Systemï¼ˆserendie.designï¼‰ã«å¾“ã†ã“ã¨ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯`@serendie/ui`ï¼ˆArk UI + Panda CSSåŸºç›¤ï¼‰ã€ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã¯`@serendie/design-token`ã€ã‚¢ã‚¤ã‚³ãƒ³ã¯`@serendie/serendie-symbols`ã‚’ä½¿ç”¨ã€‚ãƒ†ãƒ¼ãƒåˆ‡æ›¿ã¯`data-panda-theme`å±æ€§ï¼ˆkonjo/asagi/sumire/tsutsuji/kurikawaï¼‰ã€‚

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆAWS Amplify Gen 2ï¼‰
| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
|----------|------|
| ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | AWS Amplify Gen 2 (TypeScriptãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ) |
| API | AWS AppSync (GraphQL) |
| èªè¨¼ | Amazon Cognito (æ—¢å­˜User Pool: us-west-2_eaUOifAaZ) |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | Amazon DynamoDB |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | Amazon S3 |
| ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | AWS Lambda (Node.js 20.x) |
| AI | Amazon Bedrock (Claude Sonnet 4.5) |

#### ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£
| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
|----------|------|
| IaC | AWS CDK (Amplify Gen 2å†…è”µ) |
| ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | us-west-2 |
| ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° | AWS Amplify Hosting |
| CI/CD | AWS Amplify Console |
| ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° | Amazon CloudWatch |
| ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° | Sentry |

### 1.3 Amplify Gen 2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
chat-tracker/
â”œâ”€â”€ amplify/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ resource.ts              # æ—¢å­˜Cognito User Poolå‚ç…§
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ resource.ts              # GraphQLã‚¹ã‚­ãƒ¼ãƒ (TypeScript)
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â””â”€â”€ resource.ts              # S3è¨­å®š
â”‚   â”œâ”€â”€ functions/
â”‚   â”‚   â”œâ”€â”€ chat-handler/
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ prompt.ts
â”‚   â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”‚   â”œâ”€â”€ search-data/
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.ts
â”‚   â”‚   â”‚   â””â”€â”€ resource.ts
â”‚   â”‚   â””â”€â”€ seed-data/
â”‚   â”‚       â”œâ”€â”€ handler.ts
â”‚   â”‚       â””â”€â”€ resource.ts
â”‚   â””â”€â”€ backend.ts                   # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ src/                              # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ amplify_outputs.json              # Amplify Gen 2 è‡ªå‹•ç”Ÿæˆ
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.ts
```

## 2. UIè¨­è¨ˆ

### 2.1 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ 

ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆ`.tmp/ui-prototype.html` v3ï¼‰ã§æ‰¿èªã•ã‚ŒãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹é€ ã«å¾“ã†ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <header>  [icon] Chat Tracker          ç”°ä¸­å¤ªéƒ [logout] â”‚  Top App Bar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <aside>    â”‚ <main>                                      â”‚
â”‚  <nav>     â”‚  ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ« + ã‚¢ã‚¯ã‚·ãƒ§ãƒ³                   â”‚
â”‚   ãƒãƒ£ãƒƒãƒˆ  â”‚  ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢                              â”‚
â”‚   + æ–°è¦   â”‚                                             â”‚
â”‚   â± å±¥æ­´  â”‚                                             â”‚
â”‚            â”‚                                             â”‚
â”‚   ãƒ‡ãƒ¼ã‚¿   â”‚                                             â”‚
â”‚   ğŸ“ ä¿å­˜  â”‚                                             â”‚
â”‚   ğŸ¨ ãƒ†ãƒ¼ãƒ â”‚                                             â”‚
â”‚  </nav>    â”‚                                             â”‚
â”‚ </aside>   â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### HTMLè¦ç´ ã®è²¬å‹™åˆ†é›¢

| è¦ç´  | ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹ | å«ã‚€ã‚‚ã® | å«ã¾ãªã„ã‚‚ã® |
|------|-------------|---------|------------|
| `<header>` (Top App Bar) | ã‚¢ãƒ—ãƒªã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ | ã‚¢ãƒ—ãƒªå/ãƒ­ã‚´ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ |
| `<aside>` (Sidebar) | è£œåŠ©çš„ãªã‚³ãƒ³ãƒ†ãƒŠ | `<nav>`ã‚’å†…åŒ… | ãƒ–ãƒ©ãƒ³ãƒ‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± |
| `<nav>` (Navigation) | ãƒšãƒ¼ã‚¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒŠãƒ“ãƒªãƒ³ã‚¯ã®ã¿ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼‰ | ãƒ–ãƒ©ãƒ³ãƒ‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| `<main>` (Content) | ä¸»è¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ | ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ | ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ |

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°

```
src/shared/components/Layout/
â”œâ”€â”€ AppLayout.tsx    # <header> + <aside> + <main> ã®çµ±åˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”œâ”€â”€ TopBar.tsx       # <header>: ã‚¢ãƒ—ãƒªåã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
â”œâ”€â”€ Sidebar.tsx      # <aside>: <nav>ã‚’å†…åŒ…ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ
â””â”€â”€ Navigation.tsx   # <nav>: ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸãƒŠãƒ“ãƒªãƒ³ã‚¯
```

### 2.2 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆ

#### ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚°ãƒ«ãƒ¼ãƒ—

| ã‚°ãƒ«ãƒ¼ãƒ— | ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒ™ãƒ« | ãƒªãƒ³ã‚¯ | ã‚¢ã‚¤ã‚³ãƒ³ |
|---------|---------------|--------|---------|
| ãƒãƒ£ãƒƒãƒˆ | `ãƒãƒ£ãƒƒãƒˆ` | æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆ | SerendieSymbolPlus |
| | | ãƒãƒ£ãƒƒãƒˆå±¥æ­´ | SerendieSymbolHistory |
| ãƒ‡ãƒ¼ã‚¿ | `ãƒ‡ãƒ¼ã‚¿` | ä¿å­˜ãƒ‡ãƒ¼ã‚¿ | SerendieSymbolFolder |
| | | ãƒ†ãƒ¼ãƒç®¡ç† | SerendieSymbolPalette |

#### ç®¡ç†è€…ãƒ‘ãƒãƒ«ï¼ˆAdminLayoutï¼‰

| ã‚°ãƒ«ãƒ¼ãƒ— | ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒ™ãƒ« | ãƒªãƒ³ã‚¯ | ã‚¢ã‚¤ã‚³ãƒ³ |
|---------|---------------|--------|---------|
| ï¼ˆãªã—ï¼‰ | â€” | ã‚¢ãƒ—ãƒªã«æˆ»ã‚‹ | SerendieSymbolArrowLeft |
| ç®¡ç† | `ç®¡ç†` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | SerendieSymbolGroup |
| | | ãƒ†ãƒ¼ãƒç®¡ç† | SerendieSymbolPalette |
| | | ã‚·ã‚¹ãƒ†ãƒ è¨­å®š | SerendieSymbolSettings |

#### ãƒãƒ£ãƒƒãƒˆç”»é¢ï¼ˆChatLayoutï¼‰

ãƒãƒ£ãƒƒãƒˆç”»é¢ã¯ç‹¬è‡ªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼šTop App Bar + ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚µã‚¤ãƒ‰ãƒãƒ¼ + ãƒãƒ£ãƒƒãƒˆãƒ¡ã‚¤ãƒ³ã€‚
ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®`<nav>`ã¯ä½¿ç”¨ã›ãšã€`<aside>`ã«ãƒãƒ£ãƒƒãƒˆå±¥æ­´ãƒªã‚¹ãƒˆã‚’é…ç½®ã€‚

### 2.3 ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼ˆWCAG 2.2æº–æ‹ ï¼‰

| è¦ä»¶ | å®Ÿè£…æ–¹é‡ |
|------|---------|
| Skip-link | `<a href="#main-content">ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸</a>` ã‚’æœ€åˆã®è¦ç´ ã«é…ç½® |
| ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒªãƒ³ã‚° | `focus-visible` ã§4px primaryè‰²ãƒªãƒ³ã‚°ï¼ˆ`box-shadow: 0 0 0 2px surface, 0 0 0 4px primary`ï¼‰ |
| ARIAå±æ€§ | `aria-current="page"`, `aria-label`, `aria-live="polite"`, `aria-modal`, `role="log"` ç­‰ |
| ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯HTML | `<header>`, `<nav>`, `<aside>`, `<main>`, `<form>`, `<table>`, `<dialog>` |
| ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ | å…¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ ã«focuså¯èƒ½ã€Escã§ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ |
| ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆæ¯” | Serendie Design Tokenã®è‰²ã¯APCAæº–æ‹ ï¼ˆLc75+ï¼‰ |
| ãƒ•ã‚©ãƒ¼ãƒ ãƒ©ãƒ™ãƒ« | `<label>` ã®for/idç´ä»˜ã‘å¿…é ˆ |

### 2.4 ã‚¢ã‚¤ã‚³ãƒ³æ–¹é‡

- **ãƒ¢ãƒã‚¯ãƒ­SVGã®ã¿ä½¿ç”¨**ï¼ˆã‚«ãƒ©ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ãƒ»çµµæ–‡å­—ã¯ç¦æ­¢ï¼‰
- `@serendie/serendie-symbols` ã‹ã‚‰å€‹åˆ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆTree Shakingæœ‰åŠ¹åŒ–ï¼‰
- ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå: `SerendieSymbol` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆä¾‹: `SerendieSymbolHome`, `SerendieSymbolClose`ï¼‰
- Filled / Outlined ãƒãƒªã‚¢ãƒ³ãƒˆ: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯Outlinedã€é¸æŠçŠ¶æ…‹ã§Filledã‚’ä½¿ã„åˆ†ã‘
- ã‚µã‚¤ã‚º: 20pxï¼ˆãƒŠãƒ“ï¼‰ã€16pxï¼ˆãƒœã‚¿ãƒ³å†…ï¼‰ã€24pxï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰

### 2.5 ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨è¦å‰‡

- ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰å€¤ã®ç¦æ­¢ â€” å¿…ãšSerendie Design Tokenã‚’å‚ç…§
- CSSå¤‰æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³: `--sd-system-color-*`, `--sd-system-dimension-*`
- Primary: `--sd-system-color-impression-primary` (#0353AA, Konjoãƒ†ãƒ¼ãƒ)
- ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°ã‚¹ã‚±ãƒ¼ãƒ«: 4/8/12/16/20/24/32/40/48/64/80px
- ã‚¿ã‚¤ãƒã‚°ãƒ©ãƒ•ã‚£: display/headline/title/body/labelï¼ˆcompact/expandedå¯¾å¿œï¼‰
- ãƒ†ãƒ¼ãƒåˆ‡æ›¿: `data-panda-theme` å±æ€§ã§5ãƒ†ãƒ¼ãƒå¯¾å¿œ

## 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 3.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§ï¼ˆPhase 1ï¼‰
> **æ³¨è¨˜**: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆAppLayout, TopBar, Sidebar, Navigationï¼‰ã¯ã€Œ2. UIè¨­è¨ˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã€‚

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå | è²¬å‹™ | ä¾å­˜é–¢ä¿‚ |
|---|---|---|
| AuthModule | èªè¨¼ãƒ•ãƒ­ãƒ¼å…¨ä½“ã®ç®¡ç† | Cognito, Router |
| ChatModule | AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆãƒ†ã‚­ã‚¹ãƒˆ + ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰ | Bedrock, AppSync |
| ThemeModule | ãƒ†ãƒ¼ãƒCRUDæ“ä½œ | AppSync, DynamoDB |
| DataModule | ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®é–²è¦§ãƒ»ç·¨é›† | AppSync, S3 |
| ProfileModule | ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç®¡ç† | DynamoDB |
| AdminModule | ç®¡ç†è€…æ©Ÿèƒ½ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ†ãƒ¼ãƒç®¡ç†ï¼‰ | AppSync, Cognito |
| OfflineModule | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»åŒæœŸ | IndexedDB, Service Worker |

### 2.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ app/                      # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒª
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ Root.tsx
â”‚   â”œâ”€â”€ routes.tsx
â”‚   â””â”€â”€ providers.tsx
â”œâ”€â”€ features/                 # æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆFeature-Sliced Designï¼‰
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterForm.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PasswordResetForm.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useAuth.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatContainer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MessageInput.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageAttachment.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ StreamingMessage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ThemeSelector.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useChat.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useChatStream.ts
â”‚   â”‚   â”‚   â””â”€â”€ useImageUpload.ts
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ chatStore.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ theme/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ThemeList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ThemeForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ThemeFieldEditor.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ThemeCard.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useTheme.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ DataList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DataCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DataDetail.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DataForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageGallery.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EditHistoryTimeline.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SearchFilter.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useData.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ UserList.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ UserRoleEditor.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ThemeManager.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useAdmin.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ ProfileSettings.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useProfile.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ history/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ HistoryList.tsx
â”‚       â”‚   â””â”€â”€ HistoryItem.tsx
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â””â”€â”€ useHistory.ts
â”‚       â””â”€â”€ types.ts
â”œâ”€â”€ shared/                   # å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ AppLayout.tsx       # <header> + <aside> + <main> çµ±åˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ TopBar.tsx          # <header>: ãƒ–ãƒ©ãƒ³ãƒ‰ + ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx         # <aside>: <nav>ã‚³ãƒ³ãƒ†ãƒŠ
â”‚   â”‚   â”‚   â””â”€â”€ Navigation.tsx      # <nav>: ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸãƒªãƒ³ã‚¯
â”‚   â”‚   â”œâ”€â”€ ErrorBoundary.tsx
â”‚   â”‚   â”œâ”€â”€ LoadingSpinner.tsx
â”‚   â”‚   â”œâ”€â”€ ConfirmDialog.tsx
â”‚   â”‚   â””â”€â”€ OfflineIndicator.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useMediaQuery.ts
â”‚   â”‚   â”œâ”€â”€ useDebounce.ts
â”‚   â”‚   â””â”€â”€ useOnlineStatus.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ date.ts
â”‚   â”‚   â”œâ”€â”€ validation.ts
â”‚   â”‚   â””â”€â”€ markdown.ts
â”‚   â”œâ”€â”€ offline/
â”‚   â”‚   â”œâ”€â”€ db.ts                    # IndexedDBè¨­å®š (idb)
â”‚   â”‚   â”œâ”€â”€ cacheManager.ts          # ã‚­ãƒ£ãƒƒã‚·ãƒ¥èª­ã¿æ›¸ã
â”‚   â”‚   â”œâ”€â”€ syncQueue.ts             # ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ“ä½œã‚­ãƒ¥ãƒ¼
â”‚   â”‚   â””â”€â”€ serviceWorker.ts         # SWç™»éŒ²
â”‚   â””â”€â”€ constants/
â”‚       â””â”€â”€ config.ts
â””â”€â”€ types/
    â””â”€â”€ index.ts
```

### 2.3 å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è©³ç´°

#### ChatModuleï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œï¼‰

- **ç›®çš„**: AIã¨ã®ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¯¾å¿œï¼‰
- **å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:

```typescript
// hooks/useChat.ts
interface UseChatReturn {
  messages: Message[];
  isLoading: boolean;
  error: Error | null;
  sendMessage: (content: string, images?: File[]) => Promise<void>;
  startNewSession: (themeId: string) => Promise<void>;
  resumeSession: (sessionId: string) => Promise<void>;
  saveData: () => Promise<SavedData>;
}

// hooks/useChatStream.ts
interface UseChatStreamReturn {
  streamingContent: string;
  isStreaming: boolean;
  startStream: (sessionId: string, message: string) => void;
  cancelStream: () => void;
}
```

- **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Ÿè£…æ–¹é‡**:
  - AppSync Subscriptionã‚’ä½¿ç”¨ã—ã¦AIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒãƒ£ãƒ³ã‚¯å˜ä½ã§å—ä¿¡
  - Lambdaé–¢æ•°ãŒBedrockã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°APIã‚’å‘¼ã³å‡ºã—ã€ãƒãƒ£ãƒ³ã‚¯ã”ã¨ã«DynamoDBã‚’æ›´æ–°
  - DynamoDB StreamsãŒãƒˆãƒªã‚¬ãƒ¼ã¨ãªã‚Šã€AppSync Subscriptionã§é…ä¿¡

#### ThemeModule

- **ç›®çš„**: ãƒ†ãƒ¼ãƒï¼ˆä¿å­˜é …ç›®ã®å®šç¾©ï¼‰ã®CRUDæ“ä½œã‚’æä¾›
- **å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:

```typescript
// hooks/useTheme.ts
interface UseThemeReturn {
  themes: Theme[];
  favoriteThemes: Theme[];
  isLoading: boolean;
  createTheme: (input: CreateThemeInput) => Promise<Theme>;
  updateTheme: (id: string, input: UpdateThemeInput) => Promise<Theme>;
  deleteTheme: (id: string) => Promise<void>;  // Admin only
  toggleFavorite: (id: string) => Promise<void>;
}

// types.ts
interface Theme {
  id: string;
  name: string;
  fields: ThemeField[];
  createdBy: string;
  createdAt: string;
  usageCount: number;
  isDefault: boolean;
}

interface ThemeField {
  id: string;
  name: string;
  type: 'TEXT' | 'TEXTAREA' | 'DATE' | 'DATETIME' | 'NUMBER' | 'SELECT';
  required: boolean;
  options: string[] | null;
  order: number;
}
```

#### DataModule

- **ç›®çš„**: ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®é–²è¦§ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãƒ»æ¤œç´¢æ©Ÿèƒ½ã‚’æä¾›
- **å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:

```typescript
// hooks/useData.ts
interface UseDataReturn {
  data: SavedData[];
  isLoading: boolean;
  totalCount: number;
  fetchData: (filters: DataFilters) => Promise<void>;
  searchData: (keyword: string) => Promise<SavedData[]>;
  updateData: (id: string, input: UpdateDataInput) => Promise<SavedData>;
  deleteData: (id: string) => Promise<void>;  // ä½œæˆè€… or Admin only
}

// types.ts
interface SavedData {
  id: string;
  themeId: string;
  theme: Theme;
  title: string;
  content: Record<string, string | number>;
  markdownContent: string;
  images: string[];
  createdBy: string;
  createdByUser: User;
  createdAt: string;
  updatedAt: string;
  isDeleted: boolean;
}

interface DataFilters {
  themeId?: string;
  createdBy?: string;
  keyword?: string;
  dateFrom?: string;
  dateTo?: string;
  sortBy: 'createdAt' | 'updatedAt' | 'title';
  sortOrder: 'ASC' | 'DESC';
  limit: number;
  nextToken?: string;
}
```

#### AdminModule

- **ç›®çš„**: ç®¡ç†è€…å°‚ç”¨æ©Ÿèƒ½ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ãƒ†ãƒ¼ãƒç®¡ç†ï¼‰
- **å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:

```typescript
// hooks/useAdmin.ts
interface UseAdminReturn {
  users: User[];
  isLoading: boolean;
  updateUserRole: (userId: string, role: 'ADMIN' | 'MEMBER') => Promise<void>;
  deleteTheme: (themeId: string) => Promise<void>;
  mergeThemes: (sourceId: string, targetId: string) => Promise<void>;
}
```

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆï¼ˆAmplify Gen 2ï¼‰

### 3.1 ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

```typescript
// amplify/data/resource.ts

import { a, defineData, type ClientSchema } from '@aws-amplify/backend';

const schema = a.schema({

  // ========== User ==========
  User: a.model({
    email: a.string().required(),
    displayName: a.string().required(),
    role: a.enum(['ADMIN', 'MEMBER']),
    language: a.string().default('ja'),
    displayTheme: a.string().default('system'),
    favoriteThemes: a.hasMany('FavoriteTheme', 'userId'),
  }).authorization(allow => [allow.authenticated()]),

  // ========== Theme ==========
  Theme: a.model({
    name: a.string().required(),
    fields: a.json().required(),      // ThemeField[]
    createdBy: a.string().required(),
    usageCount: a.integer().default(0),
    isDefault: a.boolean().default(false),
    favorites: a.hasMany('FavoriteTheme', 'themeId'),
  }).authorization(allow => [allow.authenticated()])
    .secondaryIndexes(index => [
      index('createdBy').sortKeys(['createdAt']),
    ]),

  FavoriteTheme: a.model({
    userId: a.string().required(),
    themeId: a.string().required(),
    user: a.belongsTo('User', 'userId'),
    theme: a.belongsTo('Theme', 'themeId'),
  }).authorization(allow => [allow.authenticated()])
    .secondaryIndexes(index => [
      index('userId').sortKeys(['createdAt']),
      index('themeId'),
    ]),

  // ========== Chat Session ==========
  ChatSession: a.model({
    userId: a.string().required(),
    themeId: a.string().required(),
    title: a.string().required(),
    titleLocked: a.boolean().default(false),
    status: a.enum(['ACTIVE', 'COMPLETED', 'DRAFT']),
    messageCount: a.integer().default(0),
    messages: a.hasMany('ChatMessage', 'sessionId'),
  }).authorization(allow => [allow.authenticated()])
    .secondaryIndexes(index => [
      index('userId').sortKeys(['updatedAt']),
      index('themeId').sortKeys(['updatedAt']),
    ]),

  ChatMessage: a.model({
    sessionId: a.string().required(),
    role: a.enum(['USER', 'ASSISTANT']),
    content: a.string().required(),
    images: a.string().array(),
    isStreaming: a.boolean().default(false),
    timestamp: a.datetime().required(),
    session: a.belongsTo('ChatSession', 'sessionId'),
  }).authorization(allow => [allow.authenticated()])
    .secondaryIndexes(index => [
      index('sessionId').sortKeys(['timestamp']),
    ]),

  // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”¨ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿
  StreamChunk: a.model({
    sessionId: a.string().required(),
    messageId: a.string().required(),
    chunkIndex: a.integer().required(),
    content: a.string().required(),
    isComplete: a.boolean().default(false),
    timestamp: a.datetime().required(),
  }).authorization(allow => [allow.authenticated()])
    .secondaryIndexes(index => [
      index('sessionId').sortKeys(['chunkIndex']),
    ]),

  // ========== Saved Data ==========
  SavedData: a.model({
    themeId: a.string().required(),
    sessionId: a.string(),
    title: a.string().required(),
    content: a.json().required(),
    markdownContent: a.string().required(),
    images: a.string().array().required(),
    createdBy: a.string().required(),
    isDeleted: a.boolean().default(false),
    deletedAt: a.datetime(),
    deletedBy: a.string(),
    editHistory: a.hasMany('EditHistory', 'dataId'),
  }).authorization(allow => [allow.authenticated()])
    .secondaryIndexes(index => [
      index('themeId').sortKeys(['createdAt']),
      index('createdBy').sortKeys(['createdAt']),
      index('sessionId'),
    ]),

  EditHistory: a.model({
    dataId: a.string().required(),
    userId: a.string().required(),
    action: a.enum(['CREATE', 'UPDATE', 'DELETE']),
    changes: a.json().required(),
    snapshot: a.json().required(),
    timestamp: a.datetime().required(),
  }).authorization(allow => [allow.authenticated()])
    .secondaryIndexes(index => [
      index('dataId').sortKeys(['timestamp']),
    ]),
});

export type Schema = ClientSchema<typeof schema>;

export const data = defineData({
  schema,
  authorizationModes: {
    defaultAuthorizationMode: 'userPool',
  },
});
```

### 3.2 DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã‚µãƒãƒªãƒ¼ï¼ˆPhase 1ï¼‰

| ãƒ†ãƒ¼ãƒ–ãƒ«å | ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ | GSI |
|------------|-------------------|-----|
| User | id | - |
| Theme | id | byCreator |
| FavoriteTheme | id | byUser, byTheme |
| ChatSession | id | byUser, byTheme |
| ChatMessage | id | bySession |
| StreamChunk | id | bySession |
| SavedData | id | byTheme, byCreator, bySession |
| EditHistory | id | byData |

### 3.3 S3ãƒã‚±ãƒƒãƒˆè¨­è¨ˆ

```
chat-tracker-storage-{env}/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ default/                # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚»ãƒƒãƒˆ
â””â”€â”€ protected/{identityId}/     # ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ä¿è­·é ˜åŸŸ
    â””â”€â”€ images/                 # ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ°¸ç¶šä¿å­˜ï¼‰
        â””â”€â”€ {dataId}/{filename}
```

## 5. AIãƒãƒ£ãƒƒãƒˆè¨­è¨ˆ

### 4.1 ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ãƒ•ãƒ­ãƒ³ãƒˆ    â”‚â”€â”€â”€â–¶â”‚   AppSync     â”‚â”€â”€â”€â–¶â”‚   Lambda     â”‚
â”‚   sendMessage â”‚    â”‚   Mutation    â”‚    â”‚  chatHandler â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                        â”‚
       â”‚                                        â–¼
       â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                â”‚   Bedrock    â”‚
       â”‚                                â”‚  Streaming   â”‚
       â”‚                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                       â”‚
       â”‚                          ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒãƒ£ãƒ³ã‚¯
       â”‚                                       â”‚
       â”‚                                       â–¼
       â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                â”‚  DynamoDB    â”‚
       â”‚                                â”‚ StreamChunk  â”‚
       â”‚                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                       â”‚
       â”‚            Subscription               â”‚
       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚         onStreamChunk                 â”‚
       â–¼                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ   â”‚                               â”‚
â”‚  è¡¨ç¤ºæ›´æ–°     â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
                                               â”‚
                          å®Œäº†æ™‚               â”‚
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ ChatMessage  â”‚
                                        â”‚   ä½œæˆ       â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ

#### ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```typescript
// amplify/functions/chat-handler/prompt.ts

export const buildSystemPrompt = (
  theme: Theme,
  existingData: Record<string, unknown>
): string => `
ã‚ãªãŸã¯è£½é€ ç¾å ´ã®æƒ…å ±åé›†ã‚’æ”¯æ´ã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã‚’é€šã˜ã¦ã€å¿…è¦ãªæƒ…å ±ã‚’åé›†ã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜ã™ã‚‹æ‰‹åŠ©ã‘ã‚’ã—ã¾ã™ã€‚

## ç¾åœ¨ã®ãƒ†ãƒ¼ãƒ: ${theme.name}

## åé›†ã™ã‚‹æƒ…å ±é …ç›®:
${theme.fields
  .sort((a, b) => a.order - b.order)
  .map((f) => {
    const typeDesc = getFieldTypeDescription(f.type);
    const requiredLabel = f.required ? 'ã€å¿…é ˆã€‘' : 'ã€ä»»æ„ã€‘';
    const optionsDesc = f.options ? \` (é¸æŠè‚¢: \${f.options.join(', ')})\` : '';
    return \`- \${f.name} \${requiredLabel}: \${typeDesc}\${optionsDesc}\`;
  })
  .join('\\n')}

## ç¾åœ¨åé›†æ¸ˆã¿ã®æƒ…å ±:
${Object.entries(existingData)
  .map(([key, value]) => \`- \${key}: \${value ?? 'æœªå…¥åŠ›'}\`)
  .join('\\n')}

## ã‚ãªãŸã®å½¹å‰²:
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã™ã‚‹æƒ…å ±ã‚’è‡ªç„¶ãªå¯¾è©±ã§åé›†ã—ã¦ãã ã•ã„
2. å¿…é ˆé …ç›®ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯ã€é©åˆ‡ãªè³ªå•ã§æƒ…å ±ã‚’å¼•ãå‡ºã—ã¦ãã ã•ã„
3. æƒ…å ±ãŒæ›–æ˜§ãªå ´åˆã¯ã€å…·ä½“çš„ã«ç¢ºèªã—ã¦ãã ã•ã„
4. å…¨ã¦ã®å¿…é ˆé …ç›®ãŒæƒã£ãŸã‚‰ã€ä¿å­˜å‰ã®ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„

## å¿œç­”ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³:
- ç°¡æ½”ã§åˆ†ã‹ã‚Šã‚„ã™ã„æ—¥æœ¬èªã‚’ä½¿ç”¨
- è£½é€ ç¾å ´ã®å°‚é–€ç”¨èªã‚’ç†è§£ã—é©åˆ‡ã«å¯¾å¿œ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’å°Šé‡ã—ã¤ã¤ã€å¿…è¦ãªæƒ…å ±ã‚’æ¼ã‚Œãªãåé›†
- ç¢ºèªæ™‚ã¯ç®‡æ¡æ›¸ãã§æƒ…å ±ã‚’æ•´ç†ã—ã¦è¡¨ç¤º

## ä¿å­˜ç¢ºèªã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
å…¨ã¦ã®å¿…é ˆæƒ…å ±ãŒæƒã£ãŸå ´åˆã€ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ç¢ºèª:
"""
ä»¥ä¸‹ã®å†…å®¹ã§ä¿å­˜ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ

${theme.fields.map((f) => \`ã€\${f.name}ã€‘: {åé›†ã—ãŸå€¤}\`).join('\\n')}

ã€Œã¯ã„ã€ã¨ç­”ãˆã¦ã„ãŸã ã‘ã‚Œã°ä¿å­˜ã—ã¾ã™ã€‚ä¿®æ­£ãŒå¿…è¦ãªå ´åˆã¯ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚
"""

## é‡è¦ãªåˆ¶ç´„:
- åé›†ã—ãŸæƒ…å ±ã¯æ­£ç¢ºã«è¨˜éŒ²ã—ã€å‹æ‰‹ã«æ”¹å¤‰ã—ãªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«è¨‚æ­£ã—ãŸå ´åˆã®ã¿æƒ…å ±ã‚’æ›´æ–°
- ä¸æ˜ãªç‚¹ã¯æ¨æ¸¬ã›ãšã€å¿…ãšç¢ºèªã‚’å–ã‚‹
`;
```

#### ãƒãƒ£ãƒƒãƒˆã‚¿ã‚¤ãƒˆãƒ«è‡ªå‹•ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```typescript
export const buildTitleGenerationPrompt = (
  messages: ChatMessage[]
): string => `
ä»¥ä¸‹ã®ãƒãƒ£ãƒƒãƒˆå†…å®¹ã‹ã‚‰ã€ç°¡æ½”ãªè¦‹å‡ºã—ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

## ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
YYYY/MM/DD [å†…å®¹ã®è¦ç´„ï¼ˆ15æ–‡å­—ä»¥å†…ï¼‰]

## ãƒãƒ£ãƒƒãƒˆå†…å®¹:
${messages
  .slice(0, 5)
  .map((m) => \`\${m.role === 'USER' ? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼' : 'AI'}: \${m.content.slice(0, 200)}\`)
  .join('\\n')}

## å‡ºåŠ›
è¦‹å‡ºã—ã®ã¿ã‚’1è¡Œã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã¯ä¸è¦ã§ã™ã€‚
`;
```

### 4.3 Lambdaå®Ÿè£…ï¼ˆchatHandlerï¼‰

```typescript
// amplify/functions/chat-handler/handler.ts

import {
  BedrockRuntimeClient,
  InvokeModelWithResponseStreamCommand,
} from '@aws-sdk/client-bedrock-runtime';
import { DynamoDBDocumentClient, PutCommand } from '@aws-sdk/lib-dynamodb';
import { DynamoDBClient } from '@aws-sdk/client-dynamodb';
import { buildSystemPrompt } from './prompt';
import { env } from '$amplify/env/chat-handler';

const bedrockClient = new BedrockRuntimeClient({ region: 'us-west-2' });
const dynamoClient = DynamoDBDocumentClient.from(new DynamoDBClient({}));

export const handler = async (event: {
  arguments: { sessionId: string; content: string; images?: string[] };
  identity: { sub: string };
}) => {
  const { sessionId, content, images } = event.arguments;

  // 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ãƒ†ãƒ¼ãƒæƒ…å ±ã‚’å–å¾—
  const session = await getSession(sessionId);
  const theme = await getTheme(session.themeId);
  const messages = await getMessages(sessionId);

  // 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
  const userMessage = await saveUserMessage(sessionId, content, images);

  // 3. åé›†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æ
  const collectedData = analyzeCollectedData(messages, theme);

  // 4. ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰
  const systemPrompt = buildSystemPrompt(theme, collectedData);

  // 5. Bedrockã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‘¼ã³å‡ºã—
  const messageId = generateId();
  let fullContent = '';
  let chunkIndex = 0;

  const command = new InvokeModelWithResponseStreamCommand({
    modelId: 'anthropic.claude-sonnet-4-5-20250514',
    contentType: 'application/json',
    accept: 'application/json',
    body: JSON.stringify({
      anthropic_version: 'bedrock-2023-05-31',
      max_tokens: 4096,
      system: systemPrompt,
      messages: formatMessagesForBedrock(messages, content),
    }),
  });

  const response = await bedrockClient.send(command);

  // 6. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
  if (response.body) {
    for await (const chunk of response.body) {
      if (chunk.chunk?.bytes) {
        const parsed = JSON.parse(new TextDecoder().decode(chunk.chunk.bytes));

        if (parsed.type === 'content_block_delta' && parsed.delta?.text) {
          fullContent += parsed.delta.text;

          await dynamoClient.send(
            new PutCommand({
              TableName: env.STREAMCHUNK_TABLE_NAME,
              Item: {
                id: `${messageId}-${chunkIndex}`,
                sessionId,
                messageId,
                chunkIndex,
                content: parsed.delta.text,
                isComplete: false,
                timestamp: new Date().toISOString(),
              },
            })
          );
          chunkIndex++;
        }
      }
    }
  }

  // 7. å®Œäº†ãƒãƒ£ãƒ³ã‚¯ã‚’é€ä¿¡
  await dynamoClient.send(
    new PutCommand({
      TableName: env.STREAMCHUNK_TABLE_NAME,
      Item: {
        id: `${messageId}-complete`,
        sessionId,
        messageId,
        chunkIndex,
        content: '',
        isComplete: true,
        timestamp: new Date().toISOString(),
      },
    })
  );

  // 8. å®Œå…¨ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜
  const assistantMessage = await saveAssistantMessage(sessionId, messageId, fullContent);

  // 9. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã®è‡ªå‹•æ›´æ–°ï¼ˆ5ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»¥å†…ã®å ´åˆï¼‰
  if (!session.titleLocked && session.messageCount < 5) {
    await updateSessionTitle(sessionId, messages.concat([userMessage, assistantMessage]));
  }

  return assistantMessage;
};
```

## 5A. è‡ªå‹•ä¿å­˜ï¼ˆä¸‹æ›¸ãï¼‰è¨­è¨ˆ

### 4A.1 æ¦‚è¦

ãƒãƒ£ãƒƒãƒˆä¸­ã«åé›†ã•ã‚ŒãŸæƒ…å ±ã‚’ä¸€æ™‚ä¿å­˜ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ–­æ™‚ã®ãƒ‡ãƒ¼ã‚¿æå¤±ã‚’é˜²æ­¢ã™ã‚‹ã€‚

### 4A.2 å®Ÿè£…æ–¹é‡

- ChatSessionã®`status: DRAFT`ã‚’æ´»ç”¨
- ãƒãƒ£ãƒƒãƒˆä¸­ã«åé›†ã•ã‚ŒãŸæƒ…å ±ï¼ˆanalyzeCollectedDataï¼‰ã‚’DRAFTã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®SavedDataã¨ã—ã¦å®šæœŸçš„ã«ä¿å­˜
- `beforeunload`ã‚¤ãƒ™ãƒ³ãƒˆã§ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡æ–­ã‚’æ¤œå‡ºã—ã€æœªä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å†é–‹ã—ãŸå ´åˆã€DRAFTãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¦ç¶šè¡Œå¯èƒ½

### 4A.3 è‡ªå‹•ä¿å­˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ãƒˆãƒªã‚¬ãƒ¼ | å‹•ä½œ |
|----------|------|
| AIã®å¿œç­”å®Œäº†å¾Œï¼ˆæ¯å›ï¼‰ | åé›†æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’DRAFTã¨ã—ã¦æ›´æ–° |
| beforeunload | ç¾åœ¨ã®ãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹ã‚’DRAFTã¨ã—ã¦ä¿å­˜ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹æ™‚ | DRAFTãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å¾©å…ƒã—ã¦ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º |
| æ­£å¼ä¿å­˜æ™‚ | DRAFTã‚’å‰Šé™¤ã—ã€æœ¬ç•ªSavedDataã¨ã—ã¦ä¿å­˜ |

---

## 6. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ

### 5.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ãƒ–ãƒ©ã‚¦ã‚¶                              â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  React App   â”‚â”€â”€â”€â–¶â”‚  Cache       â”‚                  â”‚
â”‚  â”‚              â”‚â—€â”€â”€â”€â”‚  Manager     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                             â”‚                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚         â”‚                   â”‚                   â”‚      â”‚
â”‚         â–¼                   â–¼                   â–¼      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  IndexedDB   â”‚    â”‚  Sync Queue  â”‚    â”‚  Service  â”‚  â”‚
â”‚  â”‚  (idb)       â”‚    â”‚  (pending    â”‚    â”‚  Worker   â”‚  â”‚
â”‚  â”‚              â”‚    â”‚   actions)   â”‚    â”‚  (SW)     â”‚  â”‚
â”‚  â”‚  - themes    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  - sessions  â”‚           â”‚                          â”‚
â”‚  â”‚  - savedData â”‚           â”‚ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚           â”‚
â”‚  â”‚  - messages  â”‚           â–¼                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                      â”‚  AppSync     â”‚                  â”‚
â”‚                      â”‚  APIé€ä¿¡     â”‚                  â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 IndexedDB ã‚¹ã‚­ãƒ¼ãƒ

```typescript
// src/shared/offline/db.ts

import { openDB, type DBSchema } from 'idb';

interface ChatTrackerDB extends DBSchema {
  themes: {
    key: string;
    value: Theme;
    indexes: { 'by-name': string };
  };
  chatSessions: {
    key: string;
    value: ChatSession;
    indexes: { 'by-updatedAt': string };
  };
  chatMessages: {
    key: string;
    value: ChatMessage;
    indexes: { 'by-sessionId': string };
  };
  savedData: {
    key: string;
    value: SavedData;
    indexes: {
      'by-themeId': string;
      'by-updatedAt': string;
    };
  };
  syncQueue: {
    key: number;
    value: {
      id: number;
      action: 'sendMessage' | 'saveData' | 'updateData';
      payload: Record<string, unknown>;
      createdAt: string;
      retryCount: number;
    };
  };
}

export const getDB = () =>
  openDB<ChatTrackerDB>('chat-tracker', 1, {
    upgrade(db) {
      const themeStore = db.createObjectStore('themes', { keyPath: 'id' });
      themeStore.createIndex('by-name', 'name');

      const sessionStore = db.createObjectStore('chatSessions', { keyPath: 'id' });
      sessionStore.createIndex('by-updatedAt', 'updatedAt');

      const messageStore = db.createObjectStore('chatMessages', { keyPath: 'id' });
      messageStore.createIndex('by-sessionId', 'sessionId');

      const dataStore = db.createObjectStore('savedData', { keyPath: 'id' });
      dataStore.createIndex('by-themeId', 'themeId');
      dataStore.createIndex('by-updatedAt', 'updatedAt');

      db.createObjectStore('syncQueue', { keyPath: 'id', autoIncrement: true });
    },
  });
```

### 5.3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚° | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¯„å›² | æ›´æ–°æ–¹é‡ |
|---|---|---|---|
| ãƒ†ãƒ¼ãƒå®šç¾© | ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ | å…¨ä»¶ï¼ˆè»½é‡ï¼‰ | stale-while-revalidate |
| ãƒãƒ£ãƒƒãƒˆå±¥æ­´ | ã‚»ãƒƒã‚·ãƒ§ãƒ³è¡¨ç¤ºæ™‚ | é–²è¦§æ¸ˆã¿ã®ã¿ | è¡¨ç¤ºæ™‚ã«æ›´æ–° |
| ä¿å­˜ãƒ‡ãƒ¼ã‚¿ | è©³ç´°è¡¨ç¤ºæ™‚ | é–²è¦§æ¸ˆã¿ã®ã¿ | è¡¨ç¤ºæ™‚ã«æ›´æ–° |
| ç”»åƒ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾è±¡å¤– | - | - |

### 5.4 åŒæœŸã‚­ãƒ¥ãƒ¼

```typescript
// src/shared/offline/syncQueue.ts

export const processSyncQueue = async (): Promise<void> => {
  const db = await getDB();
  const queue = await db.getAll('syncQueue');

  for (const item of queue) {
    try {
      switch (item.action) {
        case 'sendMessage':
          await sendMessageToAPI(item.payload);
          break;
        case 'saveData':
          await saveDataToAPI(item.payload);
          break;
        case 'updateData':
          await updateDataToAPI(item.payload);
          break;
      }
      await db.delete('syncQueue', item.id);
    } catch (error) {
      if (item.retryCount >= 3) {
        // 3å›å¤±æ•—ã—ãŸã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
        notifyUser('åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§å†é€ä¿¡ã—ã¦ãã ã•ã„ã€‚');
        await db.delete('syncQueue', item.id);
      } else {
        await db.put('syncQueue', { ...item, retryCount: item.retryCount + 1 });
      }
    }
  }
};
```

## 7. æ¤œç´¢æ©Ÿèƒ½è¨­è¨ˆï¼ˆDynamoDB Scanï¼‰

### 6.1 æ¤œç´¢Lambdaå®Ÿè£…

```typescript
// amplify/functions/search-data/handler.ts

import { DynamoDBClient, ScanCommand } from '@aws-sdk/client-dynamodb';
import { unmarshall } from '@aws-sdk/util-dynamodb';
import { env } from '$amplify/env/search-data';

const dynamoClient = new DynamoDBClient({});

export const handler = async (event: {
  arguments: {
    keyword: string;
    themeId?: string;
    limit?: number;
    nextToken?: string;
  };
}) => {
  const { keyword, themeId, limit = 20, nextToken } = event.arguments;

  let filterExpression = 'contains(#title, :keyword) OR contains(#content, :keyword)';
  const expressionAttributeNames: Record<string, string> = {
    '#title': 'title',
    '#content': 'markdownContent',
    '#isDeleted': 'isDeleted',
  };
  const expressionAttributeValues: Record<string, { S: string } | { BOOL: boolean }> = {
    ':keyword': { S: keyword },
    ':false': { BOOL: false },
  };

  filterExpression = `(${filterExpression}) AND #isDeleted = :false`;

  if (themeId) {
    filterExpression += ' AND #themeId = :themeId';
    expressionAttributeNames['#themeId'] = 'themeId';
    expressionAttributeValues[':themeId'] = { S: themeId };
  }

  const command = new ScanCommand({
    TableName: env.SAVEDDATA_TABLE_NAME,
    FilterExpression: filterExpression,
    ExpressionAttributeNames: expressionAttributeNames,
    ExpressionAttributeValues: expressionAttributeValues,
    Limit: limit,
    ExclusiveStartKey: nextToken
      ? JSON.parse(Buffer.from(nextToken, 'base64').toString())
      : undefined,
  });

  const result = await dynamoClient.send(command);
  const items = (result.Items ?? []).map((item) => unmarshall(item));

  return {
    items,
    nextToken: result.LastEvaluatedKey
      ? Buffer.from(JSON.stringify(result.LastEvaluatedKey)).toString('base64')
      : null,
    totalCount: result.ScannedCount,
  };
};
```

### 6.2 æ¤œç´¢ã®åˆ¶é™äº‹é …

- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: 100ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ¨¡ã€æ•°åƒä»¶ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚Œã°å®Ÿç”¨çš„
- **ã‚³ã‚¹ãƒˆ**: å…¨ä»¶ã‚¹ã‚­ãƒ£ãƒ³ã®ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ ã«ä¼´ã„ã‚³ã‚¹ãƒˆå¢—åŠ 
- **å°†æ¥æ‹¡å¼µ**: ãƒ‡ãƒ¼ã‚¿é‡ãŒå¢—ãˆãŸå ´åˆã¯OpenSearchå°å…¥ã‚’æ¤œè¨

## 8. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒãƒ»ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿

### 7.1 åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥

ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«Lambdaã§åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ï¼ˆç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå«ã‚€ï¼‰ã€‚

```typescript
// amplify/functions/seed-data/handler.ts

export const handler = async () => {
  // 1. åˆå›Adminãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ
  const adminExists = await findAdminUser();
  if (!adminExists) {
    await createUser({
      id: env.INITIAL_ADMIN_USER_ID,  // Cognito User Poolã®Sub
      email: env.INITIAL_ADMIN_EMAIL,
      displayName: 'ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…',
      role: 'ADMIN',
      language: 'ja',
      displayTheme: 'system',
    });
    console.log('Initial admin user created');
  }

  // 2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒã®ä½œæˆ
  const existingDefault = await findDefaultTheme();
  if (existingDefault) {
    console.log('Default theme already exists, skipping seed');
    return;
  }

  const defaultTheme = await createTheme({
    id: 'default-trouble-maintenance',
    name: 'ãƒˆãƒ©ãƒ–ãƒ«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹',
    fields: [
      { id: 'f1', name: 'ç™ºç”Ÿæ—¥æ™‚', type: 'DATETIME', required: true, order: 1 },
      { id: 'f2', name: 'ãƒˆãƒ©ãƒ–ãƒ«å†…å®¹', type: 'TEXTAREA', required: true, order: 2 },
      { id: 'f3', name: 'åŸå› ', type: 'TEXTAREA', required: true, order: 3 },
      { id: 'f4', name: 'æš«å®šå¯¾ç­–', type: 'TEXTAREA', required: false, order: 4 },
      { id: 'f5', name: 'æ’ä¹…å¯¾ç­–', type: 'TEXTAREA', required: false, order: 5 },
    ],
    createdBy: 'SYSTEM',
    isDefault: true,
  });

  // 3. ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ£ãƒƒãƒˆå±¥æ­´ + ã‚µãƒ³ãƒ—ãƒ«ä¿å­˜ãƒ‡ãƒ¼ã‚¿ä½œæˆ
  await createSampleChatSession(defaultTheme.id);  // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ãƒãƒ£ãƒƒãƒˆå±¥æ­´
  await createSampleSavedData(defaultTheme.id);     // ã‚µãƒ³ãƒ—ãƒ«ä¿å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆ2-3ä»¶ï¼‰
  console.log('Seed data created successfully');
};
```

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 8.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡ï¼ˆPhase 1ï¼‰

| ã‚¨ãƒ©ãƒ¼ã‚«ãƒ†ã‚´ãƒª | ã‚³ãƒ¼ãƒ‰ | å¯¾å‡¦æ–¹æ³• |
|---|---|---|
| èªè¨¼ã‚¨ãƒ©ãƒ¼ | AUTH_* | ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ |
| æ¨©é™ã‚¨ãƒ©ãƒ¼ | AUTHZ_* | æ¨©é™ä¸è¶³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | VAL_* | ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º |
| AIå‡¦ç†ã‚¨ãƒ©ãƒ¼ | AI_* | ãƒªãƒˆãƒ©ã‚¤ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ | NET_* | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã¸åˆ‡ã‚Šæ›¿ãˆ |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ | OFFLINE_* | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º |
| ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ | SYS_* | ã‚¨ãƒ©ãƒ¼ãƒšãƒ¼ã‚¸è¡¨ç¤º + Sentryé€šçŸ¥ |

### 8.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
// src/shared/utils/errorHandler.ts

export const handleAppSyncError = (error: unknown) => {
  const appError = parseAppSyncError(error);

  switch (appError.code.split('_')[0]) {
    case 'AUTH':
      redirectToLogin();
      break;
    case 'AUTHZ':
      showPermissionDeniedToast(appError.message);
      break;
    case 'NET':
    case 'OFFLINE':
      enterOfflineMode();
      break;
    case 'AI':
      if (appError.retryable) {
        showRetryDialog(appError);
      } else {
        showErrorToast(appError.message);
      }
      break;
    default:
      showErrorToast(appError.message);
      Sentry.captureException(error);
  }
};
```

## 10. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 9.1 èªè¨¼ï¼ˆæ—¢å­˜Cognitoé€£æºï¼‰

```typescript
// amplify/auth/resource.ts

import { referenceAuth } from '@aws-amplify/backend';

export const auth = referenceAuth({
  userPoolId: 'us-west-2_eaUOifAaZ',
  // å¿…è¦ã«å¿œã˜ã¦Identity Pool IDã‚‚è¨­å®š
});
```

### 9.2 RBACå®Ÿè£…

```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ãƒ•ãƒƒã‚¯
// src/features/auth/hooks/useAuth.ts

interface UseAuthReturn {
  user: User | null;
  isAuthenticated: boolean;
  isAdmin: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
}

// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: Lambdaå†…ã§ã®ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
const checkAdminRole = async (userId: string): Promise<boolean> => {
  const user = await getUser(userId);
  return user.role === 'ADMIN';
};

// å‰Šé™¤æ¨©é™ãƒã‚§ãƒƒã‚¯
const canDeleteData = async (userId: string, data: SavedData): Promise<boolean> => {
  if (data.createdBy === userId) return true;
  return checkAdminRole(userId);
};
```

### 9.3 å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// Zodã‚¹ã‚­ãƒ¼ãƒï¼ˆãƒ•ãƒ­ãƒ³ãƒˆãƒ»Lambdaå…±ç”¨ï¼‰
export const createThemeSchema = z.object({
  name: z.string().min(1).max(100),
  fields: z
    .array(
      z.object({
        name: z.string().min(1).max(50),
        type: z.enum(['TEXT', 'TEXTAREA', 'DATE', 'DATETIME', 'NUMBER', 'SELECT']),
        required: z.boolean(),
        options: z.array(z.string().max(100)).max(20).optional(),
        order: z.number().int().min(0).max(100),
      })
    )
    .min(1)
    .max(20),
});
```

## 11. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 10.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æœ€é©åŒ–é …ç›® | æ‰‹æ³• |
|---|---|
| åˆæœŸãƒ­ãƒ¼ãƒ‰ | Code Splitting + React.lazy |
| çŠ¶æ…‹ç®¡ç† | TanStack Queryã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆstaleTime: 5åˆ†ï¼‰ |
| ç”»åƒ | é…å»¶èª­ã¿è¾¼ã¿ + WebPå¤‰æ› |
| ãƒãƒ³ãƒ‰ãƒ« | Tree Shaking + Dynamic Import |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ | IndexedDBã‹ã‚‰ã®å³æ™‚è¡¨ç¤º â†’ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾— |

### 10.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| æœ€é©åŒ–é …ç›® | æ‰‹æ³• |
|---|---|
| DynamoDB | GSIæ´»ç”¨ã€Queryå„ªå…ˆï¼ˆScanã¯æ¤œç´¢ã®ã¿ï¼‰ |
| Lambda | ãƒ¬ã‚¤ãƒ¤ãƒ¼å…±æœ‰ã€ç’°å¢ƒå¤‰æ•°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| AppSync | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆTTL: 60ç§’ï¼‰ |
| Bedrock | ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§ä½“æ„Ÿé€Ÿåº¦å‘ä¸Š |

## 12. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 11.1 ãƒ†ã‚¹ãƒˆæ§‹æˆ

```
tests/
â”œâ”€â”€ unit/                     # Vitest
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ offline/              # ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ integration/              # Vitest + MSW
â”‚   â””â”€â”€ api/
â””â”€â”€ e2e/                      # Playwright
    â”œâ”€â”€ auth.spec.ts
    â”œâ”€â”€ chat.spec.ts
    â”œâ”€â”€ data.spec.ts
    â”œâ”€â”€ admin.spec.ts
    â””â”€â”€ offline.spec.ts
```

### 11.2 ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

- å˜ä½“ãƒ†ã‚¹ãƒˆ: 80%ä»¥ä¸Š
- E2Eãƒ†ã‚¹ãƒˆ: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ç¶²ç¾…ï¼ˆèªè¨¼ã€ãƒãƒ£ãƒƒãƒˆã€ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€ç®¡ç†è€…æ©Ÿèƒ½ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰

## 13. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 12.1 ç’°å¢ƒæ§‹æˆ

| ç’°å¢ƒ | ãƒ–ãƒ©ãƒ³ãƒ | ç”¨é€” |
|------|----------|------|
| dev | develop | é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ |
| staging | staging | QAãƒ»UAT |
| prod | main | æœ¬ç•ª |

### 12.2 Amplify Gen 2 ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ï¼‰
npx ampx sandbox

# ãƒ‡ãƒ—ãƒ­ã‚¤
npx ampx pipeline-setup  # CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®š
```

ç’°å¢ƒå¤‰æ•°ï¼ˆAmplify Console ã§è¨­å®šï¼‰:
- `INITIAL_ADMIN_EMAIL`: åˆå›ç®¡ç†è€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `INITIAL_ADMIN_USER_ID`: åˆå›ç®¡ç†è€…ã®Cognito Sub

## 14. å®Ÿè£…ä¸Šã®æ³¨æ„äº‹é …

### 13.1 ä¸€èˆ¬çš„ãªæ³¨æ„äº‹é …

- TypeScript strict modeæœ‰åŠ¹
- `any`å‹ã®ä½¿ç”¨ç¦æ­¢
- classã¯å¿…è¦ãªå ´åˆã®ã¿ï¼ˆErrorç¶™æ‰¿ãªã©ï¼‰
- ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç¦æ­¢ï¼ˆç’°å¢ƒå¤‰æ•°ãƒ»å®šæ•°ã‚’ä½¿ç”¨ï¼‰

### 13.2 Amplify Gen 2 å›ºæœ‰ã®æ³¨æ„äº‹é …

- `amplify_outputs.json`ã¯Gen 2ãŒè‡ªå‹•ç”Ÿæˆï¼ˆ`aws-exports.js`ã®ä»£æ›¿ï¼‰
- ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã¯TypeScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ç·¨é›†
- Lambdaé–¢æ•°ã¯Gen 2ã®`defineFunction`ã§å®šç¾©
- `$amplify/env/`ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹
- ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é–‹ç™ºãŒå¯èƒ½

### 13.3 æ—¢å­˜Cognitoé€£æºã®æ³¨æ„äº‹é …

- æ—¢å­˜User Poolï¼ˆus-west-2_eaUOifAaZï¼‰ã®è¨­å®šå¤‰æ›´ã¯æœ€å°é™ã«
- ãƒ­ãƒ¼ãƒ«æƒ…å ±ã¯DynamoDB Userãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†ï¼ˆCognitoã‚°ãƒ«ãƒ¼ãƒ—ã¯ä½¿ç”¨ã—ãªã„ï¼‰
- `referenceAuth`ã§Gen 2ã‹ã‚‰æ—¢å­˜ãƒªã‚½ãƒ¼ã‚¹ã‚’å‚ç…§

---

**ä½œæˆæ—¥**: 2026-01-28
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.1
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­
**å¤‰æ›´å±¥æ­´**:
- 1.0: åˆç‰ˆä½œæˆ
- 1.1: Gen 1ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œè¿½åŠ ã€æ—¢å­˜Cognitoé€£æº
- 2.0: Amplify Gen 2ã¸ç§»è¡Œã€Phase 1ã‚¹ã‚³ãƒ¼ãƒ—ã«é™å®šï¼ˆéŸ³å£°/ãƒãƒ¼ãƒ /é€šçŸ¥ã‚’é™¤å¤–ï¼‰ã€RBACè¿½åŠ ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¿½åŠ ã€ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã«Adminä½œæˆè¿½åŠ 
- 2.1: è‡ªå‹•ä¿å­˜ï¼ˆä¸‹æ›¸ãï¼‰è¨­è¨ˆè¿½åŠ ã€ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã«ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’æ˜ç¤º
